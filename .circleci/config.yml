version: 2.1

parameters:
  no-promote:
    type: boolean
    default: false
#Warns Circleci that setup is going to happen
setup: true

orbs:
  continuation: circleci/continuation@0.1.2

executors:
  base:
    docker:
      - image: cimg/base:2021.04
    working_directory: /tmp/stdcheck.com

commands:
  git_check_no_promote:
    description: Checks if the commit contains the "No promote" tag, and writes the result to the file ./is-no-promote.
    steps:
      - run:
          name: Check "No Promote" Tag
          command: .circleci/bin/git/check-no-promote.sh

  continue-promote:
    description: Continues with the Promote Workflow
    steps:
      - continuation/continue:
          configuration_path: promote.yml # use newly generated config to continue

  continue-no-promote:
    description: Continues with the No Promote Workflow
    steps:
      - continuation/continue:
          configuration_path: no-promote.yml # use newly generated config to continue


jobs:
  check-no-promote:
    executor: base
    steps:
      - checkout
      -  git_check_no_promote
      - run:
          name: Checks if the PR has the No promote tag. Halts downstream jobs if not the case
          command: cat is-no-promote
      when:
        condition: true
        steps:
          - run: echo "Esto deberia imprimirse"
      when:
        condition: false
        steps:
          - run: echo "Esto no  deberia imprimirse"


workflows:
  version: 2
  setup:
    jobs:
      - check-no-promote
